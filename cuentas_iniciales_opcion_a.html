{{-- 
  EJEMPLO DE VISTA MEJORADA - cuentas_iniciales_modal.blade.php
  OPCIÓN A: Datos directos del servidor (sin JavaScript adicional)
--}}

@extends('layouts.nice', ['active' => 'cuentas_iniciales'])

@section('title', 'Configuración de Cuentas Iniciales')

@section('content')

{{-- Incluir estilos modernos del módulo contable --}}
@include('orgs.contable.partials.contable-styles')

<div class="contable-container">
    <!-- Breadcrumbs modernos -->
    <nav class="contable-breadcrumb">
        <a href="{{ route('orgs.dashboard', ['id' => $orgId]) }}" class="contable-breadcrumb-item">
            <i class="bi bi-house-door"></i> Inicio
        </a>
        <span class="contable-breadcrumb-separator">
            <i class="bi bi-chevron-right"></i>
        </span>
        <a href="#" class="contable-breadcrumb-item">Contable</a>
        <span class="contable-breadcrumb-separator">
            <i class="bi bi-chevron-right"></i>
        </span>
        <span class="contable-breadcrumb-item active">Configuración de Cuentas Iniciales</span>
    </nav>

    <!-- Sección principal -->
    <div class="contable-section">
        <div class="contable-header">
            <div>
                <h1 class="contable-title">
                    <i class="bi bi-gear-fill"></i>
                    Configuración de Cuentas Iniciales
                </h1>
                <p class="contable-subtitle">Configure los saldos iniciales y datos bancarios de su organización</p>
            </div>
        </div>

        <div class="contable-body">
            {{-- Verificar si ya existen configuraciones --}}
            @if(isset($configuraciones) && $configuraciones->count() > 0)
                
                {{-- MOSTRAR CONFIGURACIONES EXISTENTES --}}
                <div class="contable-alert contable-alert-success contable-mb-xl">
                    <i class="bi bi-check-circle"></i>
                    <div>
                        <p><strong>Configuración Existente:</strong> Ya tienes cuentas configuradas. Puedes editarlas a continuación.</p>
                    </div>
                </div>

                {{-- Resumen de saldos actual --}}
                @include('orgs.contable.partials.resumen-saldos')

                {{-- Tabla de configuraciones existentes --}}
                <div class="contable-card contable-mb-xl">
                    <div class="contable-card-header">
                        <h3 class="contable-card-title">
                            <i class="bi bi-table"></i>
                            Cuentas Configuradas
                        </h3>
                    </div>
                    <div class="contable-card-body">
                        <div class="contable-table-responsive">
                            <table class="contable-table contable-table-striped">
                                <thead>
                                    <tr>
                                        <th>Tipo de Cuenta</th>
                                        <th>Saldo Inicial</th>
                                        <th>Banco</th>
                                        <th>N° Cuenta</th>
                                        <th>Responsable</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach($configuraciones as $config)
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                @switch($config->tipo_cuenta)
                                                    @case('caja_general')
                                                        <i class="bi bi-cash-stack text-success me-2"></i>
                                                        Caja General
                                                        @break
                                                    @case('cuenta_corriente_1')
                                                        <i class="bi bi-credit-card text-primary me-2"></i>
                                                        Cuenta Corriente 1
                                                        @break
                                                    @case('cuenta_corriente_2')
                                                        <i class="bi bi-credit-card-2-front text-info me-2"></i>
                                                        Cuenta Corriente 2
                                                        @break
                                                    @case('cuenta_ahorro')
                                                        <i class="bi bi-piggy-bank-fill text-warning me-2"></i>
                                                        Cuenta de Ahorro
                                                        @break
                                                    @default
                                                        <i class="bi bi-bank text-muted me-2"></i>
                                                        {{ ucfirst(str_replace('_', ' ', $config->tipo_cuenta)) }}
                                                @endswitch
                                            </div>
                                        </td>
                                        <td>
                                            <span class="contable-badge contable-badge-primary">
                                                ${{ number_format($config->saldo_inicial, 0, ',', '.') }}
                                            </span>
                                        </td>
                                        <td>
                                            @if($config->nombre_banco)
                                                <div class="d-flex align-items-center">
                                                    <i class="bi bi-bank2 text-muted me-1"></i>
                                                    {{ $config->nombre_banco }}
                                                </div>
                                            @else
                                                <span class="text-muted">Sin banco</span>
                                            @endif
                                        </td>
                                        <td>
                                            @if($config->numero_cuenta)
                                                <code class="text-dark">{{ $config->numero_cuenta }}</code>
                                            @else
                                                <span class="text-muted">-</span>
                                            @endif
                                        </td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <i class="bi bi-person-fill text-secondary me-1"></i>
                                                {{ $config->responsable }}
                                            </div>
                                        </td>
                                        <td>
                                            @if($config->copiado_a_cuentas)
                                                <span class="contable-badge contable-badge-success">
                                                    <i class="bi bi-check-circle"></i>
                                                    Activo
                                                </span>
                                            @else
                                                <span class="contable-badge contable-badge-warning">
                                                    <i class="bi bi-clock"></i>
                                                    Pendiente
                                                </span>
                                            @endif
                                        </td>
                                        <td>
                                            <div class="d-flex gap-2">
                                                <button class="contable-btn contable-btn-sm contable-btn-outline" 
                                                        onclick="editarConfiguracion({{ $config->id }})">
                                                    <i class="bi bi-pencil"></i>
                                                    Editar
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    @endforeach
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            @else
                
                {{-- FORMULARIO INICIAL CUANDO NO HAY CONFIGURACIONES --}}
                <div class="contable-alert contable-alert-info contable-mb-xl">
                    <i class="bi bi-info-circle"></i>
                    <div>
                        <p><strong>Primera Configuración:</strong> Configure los saldos iniciales de sus cuentas. Esta información es fundamental para el correcto funcionamiento del sistema contable.</p>
                    </div>
                </div>

                <form action="{{ route('contable.store', ['id' => $orgId]) }}" method="POST" class="contable-form">
                    @csrf
                    <input type="hidden" name="orgId" value="{{ $orgId }}">

                    {{-- Caja General --}}
                    <div class="contable-card contable-mb-xl">
                        <div class="contable-card-header">
                            <h3 class="contable-card-title">
                                <i class="bi bi-cash-stack"></i>
                                Caja General (Efectivo)
                            </h3>
                        </div>
                        <div class="contable-card-body">
                            <div class="contable-form-grid contable-form-grid-1">
                                <div class="contable-form-group">
                                    <label class="contable-form-label">
                                        <i class="bi bi-currency-dollar"></i>
                                        Saldo Inicial
                                        <span class="contable-required">*</span>
                                    </label>
                                    <input type="number" 
                                           name="saldo_caja_general" 
                                           class="contable-form-input"
                                           step="1" 
                                           min="0" 
                                           placeholder="Ingrese el saldo inicial en efectivo"
                                           required>
                                </div>
                            </div>
                        </div>
                    </div>

                    {{-- Cuenta Corriente 1 --}}
                    <div class="contable-card contable-mb-xl">
                        <div class="contable-card-header">
                            <h3 class="contable-card-title">
                                <i class="bi bi-credit-card"></i>
                                Cuenta Corriente Principal
                            </h3>
                        </div>
                        <div class="contable-card-body">
                            <div class="contable-form-grid contable-form-grid-3">
                                <div class="contable-form-group">
                                    <label class="contable-form-label">
                                        <i class="bi bi-currency-dollar"></i>
                                        Saldo Inicial
                                        <span class="contable-required">*</span>
                                    </label>
                                    <input type="number" 
                                           name="saldo_cta_corriente_1" 
                                           class="contable-form-input"
                                           step="1" 
                                           min="0" 
                                           placeholder="Saldo de la cuenta corriente"
                                           required>
                                </div>
                                <div class="contable-form-group">
                                    <label class="contable-form-label">
                                        <i class="bi bi-bank"></i>
                                        Banco
                                    </label>
                                    <select name="banco_cta_corriente_1" class="contable-form-select">
                                        <option value="">Seleccionar banco</option>
                                        @foreach($bancos as $banco)
                                            <option value="{{ $banco->id }}">{{ $banco->nombre }}</option>
                                        @endforeach
                                    </select>
                                </div>
                                <div class="contable-form-group">
                                    <label class="contable-form-label">
                                        <i class="bi bi-hash"></i>
                                        Número de Cuenta
                                    </label>
                                    <input type="text" 
                                           name="numero_cta_corriente_1"
                                           class="contable-form-input"
                                           placeholder="Ej: 12345678-9">
                                </div>
                            </div>
                        </div>
                    </div>

                    {{-- Cuenta de Ahorro --}}
                    <div class="contable-card contable-mb-xl">
                        <div class="contable-card-header">
                            <h3 class="contable-card-title">
                                <i class="bi bi-piggy-bank-fill"></i>
                                Cuenta de Ahorro
                            </h3>
                        </div>
                        <div class="contable-card-body">
                            <div class="contable-form-grid contable-form-grid-3">
                                <div class="contable-form-group">
                                    <label class="contable-form-label">
                                        <i class="bi bi-currency-dollar"></i>
                                        Saldo Inicial
                                        <span class="contable-required">*</span>
                                    </label>
                                    <input type="number" 
                                           name="saldo_cuenta_ahorro" 
                                           class="contable-form-input"
                                           step="1" 
                                           min="0" 
                                           placeholder="Saldo de la cuenta de ahorro"
                                           required>
                                </div>
                                <div class="contable-form-group">
                                    <label class="contable-form-label">
                                        <i class="bi bi-bank"></i>
                                        Banco
                                    </label>
                                    <select name="banco_cuenta_ahorro" class="contable-form-select">
                                        <option value="">Seleccionar banco</option>
                                        @foreach($bancos as $banco)
                                            <option value="{{ $banco->id }}">{{ $banco->nombre }}</option>
                                        @endforeach
                                    </select>
                                </div>
                                <div class="contable-form-group">
                                    <label class="contable-form-label">
                                        <i class="bi bi-hash"></i>
                                        Número de Cuenta
                                    </label>
                                    <input type="text" 
                                           name="numero_cuenta_ahorro"
                                           class="contable-form-input"
                                           placeholder="Ej: 98765432-1">
                                </div>
                            </div>
                        </div>
                    </div>

                    {{-- Información del Responsable --}}
                    <div class="contable-card contable-mb-xl">
                        <div class="contable-card-header">
                            <h3 class="contable-card-title">
                                <i class="bi bi-person-check"></i>
                                Responsable de la Configuración
                            </h3>
                        </div>
                        <div class="contable-card-body">
                            <div class="contable-form-grid contable-form-grid-1">
                                <div class="contable-form-group">
                                    <label class="contable-form-label">
                                        <i class="bi bi-person-fill"></i>
                                        Nombre del Responsable
                                        <span class="contable-required">*</span>
                                    </label>
                                    <input type="text" 
                                           name="responsable" 
                                           class="contable-form-input"
                                           placeholder="Nombre completo del responsable"
                                           value="{{ auth()->user()->name ?? '' }}"
                                           required>
                                </div>
                            </div>
                        </div>
                    </div>

                    {{-- Botones de acción --}}
                    <div class="contable-card-footer">
                        <a href="{{ route('orgs.dashboard', ['id' => $orgId]) }}" class="contable-btn contable-btn-outline">
                            <i class="bi bi-arrow-left"></i>
                            Cancelar
                        </a>
                        <button type="submit" class="contable-btn contable-btn-primary">
                            <i class="bi bi-save"></i>
                            Guardar Configuración
                        </button>
                    </div>
                </form>

            @endif
        </div>
    </div>
</div>

{{-- JavaScript mínimo para funcionalidad adicional --}}
<script>
function editarConfiguracion(id) {
    // Función para editar configuración existente
    console.log('Editar configuración ID:', id);
    // Aquí podrías abrir un modal o redirigir a página de edición
}

// Validación del formulario
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('.contable-form');
    if (form) {
        form.addEventListener('submit', function(e) {
            // Validaciones adicionales si es necesario
            console.log('Enviando formulario de cuentas iniciales');
        });
    }
});
</script>

@endsection
